<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết hóa đơn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-file-invoice"></i> Chi tiết hóa đơn: <strong th:text="${order.orderNumber}">POS-001</strong>
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Thông tin khách hàng -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6>Thông tin khách hàng</h6>
                                <p><strong>Tên:</strong> <span th:text="${customer != null ? customer.name : 'Khách vãng lai'}">Nguyễn Văn A</span></p>
                                <p><strong>SĐT:</strong> <span th:text="${customer != null and customer.phone != null ? customer.phone : ''}">0123456789</span></p>
                                <p th:if="${customer != null and customer.address != null and !customer.address.isEmpty()}">
                                    <strong>Địa chỉ:</strong> <span th:text="${customer.address}">123 Đường ABC</span>
                                </p>
                                <p th:if="${customer != null and (customer.ward != null or customer.district != null or customer.province != null)}">
                                    <strong>Khu vực:</strong> 
                                    <span th:text="${(customer.ward != null and !customer.ward.isEmpty() ? customer.ward + ', ' : '') + 
                                                    (customer.district != null and !customer.district.isEmpty() ? customer.district + ', ' : '') + 
                                                    (customer.province != null and !customer.province.isEmpty() ? customer.province : '')}">Phường 1, Quận 1, TP.HCM</span>
                                </p>
                                <p th:if="${customer != null and customer.dateOfBirth != null}">
                                    <strong>Ngày sinh:</strong> <span th:text="${#temporals.format(customer.dateOfBirth, 'dd/MM/yyyy')}">01/01/1990</span>
                                </p>
                                <p><strong>VIP:</strong> 
                                    <span th:if="${customer != null and customer.isVip}" class="badge bg-success">Có</span>
                                    <span th:unless="${customer != null and customer.isVip}" class="badge bg-secondary">Không</span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6>Thông tin hóa đơn</h6>
                                <p><strong>Mã hóa đơn:</strong> <span th:text="${order.orderNumber}">POS-001</span></p>
                                <p><strong>Ngày tạo:</strong> <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2025 10:30</span></p>
                                <p><strong>Trạng thái:</strong> 
                                    <span th:if="${order.status == 'COMPLETED'}" class="badge bg-success">Hoàn thành</span>
                                    <span th:if="${order.status == 'PENDING'}" class="badge bg-warning">Đang xử lý</span>
                                    <span th:if="${order.status == 'CANCELLED'}" class="badge bg-danger">Hủy</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Danh sách sản phẩm -->
                        <h6>Danh sách sản phẩm đã mua</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${orderItems}">
                                        <td th:text="${item.product != null ? item.product.name : 'Sản phẩm không xác định'}">Sản phẩm A</td>
                                        <td th:text="${item.quantity}">1</td>
                                        <td th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">100,000 VNĐ</td>
                                        <td th:text="${#numbers.formatDecimal(item.quantity * item.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">100,000 VNĐ</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Tóm tắt thanh toán -->
                        <div class="row mt-4">
                            <div class="col-md-6 offset-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Tổng tiền:</strong></td>
                                        <td class="text-end" th:text="${#numbers.formatDecimal(originalTotal, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">199,000 VNĐ</td>
                                    </tr>
                                    <tr th:if="${hasDiscount and actualDiscount > 0}">
                                        <td><strong>Giảm giá VIP:</strong></td>
                                        <td class="text-end text-success" th:text="'-' + ${#numbers.formatDecimal(actualDiscount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">-9,950 VNĐ</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Thành tiền:</strong></td>
                                        <td class="text-end fw-bold" th:text="${#numbers.formatDecimal(actualPaidAmount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">189,050 VNĐ</td>
                                    </tr>
<tr>
    <td><strong>Phương thức thanh toán:</strong></td>
    <td class="text-end">
<span th:switch="${#strings.toUpperCase(order.paymentMethod)}">
    <span th:case="'CASH'">Tiền mặt</span>
    <span th:case="'TRANSFER'">Chuyển khoản</span>
    <span th:case="'CARD'">Thẻ</span>
    <span th:case="*">Khác</span>
</span>
    </td>
</tr>
                                </table>
                            </div>
                        </div>

                        <!-- Nút quay lại -->
                        <div class="text-center mt-4">
                            <a th:href="@{/admin/revenue}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay lại danh sách doanh thu
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>