<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lịch Sử Giao Dịch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .search-bar { margin-bottom: 24px; }
        .table th, .table td { vertical-align: middle; }
        .order-info { margin-top: 32px; }
        .btn-back-pos {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 10;
        }
        @media (max-width: 768px) {
            .btn-back-pos { top: 8px; left: 8px; }
        }
    </style>
</head>
<body>
<div class="container mt-4 position-relative">
    <a href="/user/pos" class="btn btn-primary btn-back-pos">
        <i class="fas fa-arrow-left"></i> Quay lại POS
    </a>
    <h2 class="mb-4 text-center">Lịch Sử Giao Dịch</h2>
    
    <!-- Search Bar -->
    <form class="row search-bar" method="get" th:action="@{/user/pos/history}">
        <div class="col-md-3 mb-2 mb-md-0">
            <input type="date" class="form-control" name="date" th:value="${param.date}">
        </div>
        <div class="col-md-5 mb-2 mb-md-0">
            <input type="text" class="form-control" name="customerName" placeholder="Tìm theo tên khách hàng..." th:value="${param.customerName}">
        </div>
        <div class="col-md-2 mb-2 mb-md-0">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-search"></i> Tìm kiếm
            </button>
        </div>
        <div class="col-md-2">
            <a href="/user/pos/history" class="btn btn-secondary w-100">Xem tất cả</a>
        </div>
    </form>
    
    <div th:if="${orders != null and !orders.isEmpty()}">
        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Mã đơn</th>
                    <th>Ngày tạo</th>
                    <th>Khách hàng</th>
                    <th>Thành tiền</th>
                    <th>Trạng thái</th>
                    <th>Chi tiết</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="order : ${orders}">
                    <td th:text="${order.orderNumber}"></td>
                    <td th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                    <td th:text="${order.customer != null ? order.customer.name : 'Khách lẻ'}"></td>
                    <td th:text="${#numbers.formatDecimal(order.finalAmount, 0, 'COMMA', 0, 'POINT') + ' VNĐ'}"></td>
                    <td>
                        <span th:text="${order.status}" th:classappend="${order.status == 'COMPLETED'} ? 'text-success' : 'text-warning'"></span>
                    </td>
                    <td>
                        <a th:href="@{'/user/pos/historyoder?id=' + ${order.id}}" class="btn btn-sm btn-info">
                            <i class="fas fa-file-invoice"></i> Xem hóa đơn
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div th:if="${orders == null or orders.isEmpty()}" class="alert alert-info mt-4">
        Bạn chưa có đơn hàng nào.
    </div>
</div>
</body>
</html>